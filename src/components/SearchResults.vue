<!-- src/components/SearchResults.vue -->
<template>
  <div class="results-section">
    <div class="uk-container">
      <div class="results">
        <ul uk-accordion>
          <li class="card">
            <div class="uk-accordion-title flex">
              <div class="results-percents">
                                    <span class="percents">
                                        <span>
                                            <span class="symbol">%</span>
                                            5
                                        </span>
                                        הנחה</span>
              </div>
              <div class="results-logo">
                <div class="results-bage" hidden>if bage</div>
                <img src="/images/logos/logo-bradex.png" alt="Bradex" />
              </div>
              <div class="text">
                <div class="results-title">BRADEX</div>
                <div class="results-text">
                  <p>רהיטים, ספות, ספות נפתחות, מיטות, מערכות ישיבה, כורסאות</p>
                </div>
              </div>
              <div class="results-location">
                                    <span class="icon">
                                        <img src="/images/icons/icon-location.svg" alt="Icon" />
                                    </span>
                50 meters from you
              </div>
              <div class="results-icons">
                <a href="" class="results-phone">
                                            <span class="icon">
                                                <img src="/images/icons/icon-phone.svg" alt="Icon" />
                                            </span>
                </a>
                <a href="" class="results-waze">
                                            <span class="icon">
                                                <img src="/images/icons/icon-waze.svg" alt="Icon" />
                                            </span>
                </a>
              </div>
              <div class="accordion">
                                    <span class="icon">
                                        <img src="/images/icons/icon-plus-accordion.svg" alt="Icon" />
                                        <img src="/images/icons/icon-minus-accordion.svg" alt="Icon" />
                                    </span>
              </div>
            </div>

            <div class="uk-accordion-content">
              <div class="results-additional">
                <div class="flex">
                  <div class="info">
                    <div class="info-flex">
                      <div class="results-big-text">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</p>
                      </div>
                      <div class="item">
                        <div class="results-website">
                          <a href="www.lorem-ipsum.com" target="_blank">
                            <div class="icon">
                              <img src="/images/icons/icon-globe.svg" alt="Icon" />
                            </div>
                            www.lorem-ipsum.com
                          </a>
                        </div>
                        <div class="results-email">
                          <a href="mailto:lorem-ipsum@lorem-ipsum.com">
                            <div class="icon">
                              <img src="/images/icons/icon-mail.svg" alt="Icon" />
                            </div>
                            lorem-ipsum@lorem-ipsum.com
                          </a>
                        </div>
                      </div>
                      <div class="locations-wrapper">
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="results-map">
                      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d43175.80723702404!2d-0.23689632527217233!3d51.51110006081656!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48760fefa6be6ee7%3A0x6a59f820ac676c4d!2sHolland%20Park!5e0!3m2!1sen!2scz!4v1738855438273!5m2!1sen!2scz" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
          <li class="card multiple">

            <div class="uk-accordion-title flex">
              <div class="results-percents">
                                    <span class="percents">
                                        <span>
                                            <span class="symbol">%</span>
                                            54
                                        </span>
                                        הנחה</span>
              </div>
              <div class="results-logo">
                <div class="results-bage">רשת חנויות</div>
                <img src="/images/logos/logo-bradex.png" alt="Bradex" />
              </div>
              <div class="text">
                <div class="results-title">
                  BRADEX
                  <div class="results-stores">
                    (50 stores + 2 <span>New</span>)
                  </div>

                </div>
                <div class="results-text">
                  <p>רהיטים, ספות, ספות נפתחות, מיטות, מערכות ישיבה, כורסאות</p>
                </div>
              </div>
              <div class="results-location">
                                    <span class="icon">
                                        <img src="/images/icons/icon-location.svg" alt="Icon" />
                                    </span>
                50 meters from you
              </div>
              <div class="results-icons">
                <a href="" class="results-phone">
                                            <span class="icon">
                                                <img src="/images/icons/icon-phone.svg" alt="Icon" />
                                            </span>
                </a>
                <a href="" class="results-waze">
                                            <span class="icon">
                                                <img src="/images/icons/icon-waze.svg" alt="Icon" />
                                            </span>
                </a>
              </div>
              <div class="accordion">
                                    <span class="icon">
                                        <img src="/images/icons/icon-plus-accordion.svg" alt="Icon" />
                                        <img src="/images/icons/icon-minus-accordion.svg" alt="Icon" />
                                    </span>
              </div>
            </div>

            <div class="uk-accordion-content">
              <div class="results-additional">
                <div class="flex">
                  <div class="info">
                    <div class="info-flex">
                      <div class="results-big-text">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</p>
                      </div>
                      <div class="item">
                        <div class="results-website">
                          <a href="www.lorem-ipsum.com" target="_blank">
                            <div class="icon">
                              <img src="/images/icons/icon-globe.svg" alt="Icon" />
                            </div>
                            www.lorem-ipsum.com
                          </a>
                        </div>
                        <div class="results-email">
                          <a href="mailto:lorem-ipsum@lorem-ipsum.com">
                            <div class="icon">
                              <img src="/images/icons/icon-mail.svg" alt="Icon" />
                            </div>
                            lorem-ipsum@lorem-ipsum.com
                          </a>
                        </div>
                      </div>
                      <div class="locations-wrapper">
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="results-map">
                      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d43175.80723702404!2d-0.23689632527217233!3d51.51110006081656!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48760fefa6be6ee7%3A0x6a59f820ac676c4d!2sHolland%20Park!5e0!3m2!1sen!2scz!4v1738855438273!5m2!1sen!2scz" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
          <li class="card">

            <div class="uk-accordion-title flex">
              <div class="results-percents">
                                    <span class="percents">
                                        <span>
                                            <span class="symbol">%</span>
                                            51
                                        </span>
                                        הנחה</span>
              </div>
              <div class="results-logo">
                <div class="results-bage" hidden>if bage</div>
                <img src="/images/logos/logo-bradex.png" alt="Bradex" />
              </div>
              <div class="text">
                <div class="results-title">BRADEX</div>
                <div class="results-text">
                  <p>רהיטים, ספות, ספות נפתחות, מיטות, מערכות ישיבה, כורסאות</p>
                </div>
              </div>
              <div class="results-location">
                                    <span class="icon">
                                        <img src="/images/icons/icon-location.svg" alt="Icon" />
                                    </span>
                50 meters from you
              </div>
              <div class="results-icons">
                <a href="" class="results-phone">
                                            <span class="icon">
                                                <img src="/images/icons/icon-phone.svg" alt="Icon" />
                                            </span>
                </a>
                <a href="" class="results-waze">
                                            <span class="icon">
                                                <img src="/images/icons/icon-waze.svg" alt="Icon" />
                                            </span>
                </a>
              </div>
              <div class="accordion">
                                    <span class="icon">
                                        <img src="/images/icons/icon-plus-accordion.svg" alt="Icon" />
                                        <img src="/images/icons/icon-minus-accordion.svg" alt="Icon" />
                                    </span>
              </div>
            </div>

            <div class="uk-accordion-content">
              <div class="results-additional">
                <div class="flex">
                  <div class="info">
                    <div class="info-flex">
                      <div class="results-big-text">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</p>
                      </div>
                      <div class="item">
                        <div class="results-website">
                          <a href="www.lorem-ipsum.com" target="_blank">
                            <div class="icon">
                              <img src="/images/icons/icon-globe.svg" alt="Icon" />
                            </div>
                            www.lorem-ipsum.com
                          </a>
                        </div>
                        <div class="results-email">
                          <a href="mailto:lorem-ipsum@lorem-ipsum.com">
                            <div class="icon">
                              <img src="/images/icons/icon-mail.svg" alt="Icon" />
                            </div>
                            lorem-ipsum@lorem-ipsum.com
                          </a>
                        </div>
                      </div>
                      <div class="locations-wrapper">
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="results-map">
                      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d43175.80723702404!2d-0.23689632527217233!3d51.51110006081656!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48760fefa6be6ee7%3A0x6a59f820ac676c4d!2sHolland%20Park!5e0!3m2!1sen!2scz!4v1738855438273!5m2!1sen!2scz" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>
          <li class="card" v-for="result in results" :key="result.id">
            <div class="uk-accordion-title flex">
              <div class="results-percents">
                <span class="percents">
                    <span>
                        <span class="symbol">%</span>
                        {{ result.SL_DiscountTitle1 }}
                    </span>
                    הנחה</span>
              </div>
              <div class="results-logo">
                <div class="results-bage" hidden>if bage</div>
                <img :src="imageUrl(result.SL_LogoName)" :alt="result.SL_Loc_Name" />
              </div>
              <div class="text">
                <div class="results-title">{{ result.SL_Loc_Name }}</div>
                <div class="results-text">
                  <p>{{ result.SL_LocDescription}}</p>
                </div>
              </div>
              <div class="results-location" v-if="userLocation()">
                <span class="icon">
                    <img src="/images/icons/icon-location.svg" alt="Icon" />
                </span>
                {{ calculateDistance(result.SL_Location) }} meters from you
              </div>
              <div class="results-icons" v-if="!result.SL_CH_Code">
                <a href="" class="results-phone">
                                            <span class="icon">
                                                <img src="/images/icons/icon-phone.svg" alt="Icon" />
                                            </span>
                </a>
                <a href="" class="results-waze">
                                            <span class="icon">
                                                <img src="/images/icons/icon-waze.svg" alt="Icon" />
                                            </span>
                </a>
              </div>
              <div class="accordion">
                                    <span class="icon">
                                        <img src="/images/icons/icon-plus-accordion.svg" alt="Icon" />
                                        <img src="/images/icons/icon-minus-accordion.svg" alt="Icon" />
                                    </span>
              </div>
            </div>

            <div class="uk-accordion-content">
              <div class="results-additional">
                <div class="flex">
                  <div class="info">
                    <div class="info-flex">
                      <div class="results-big-text">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</p>
                      </div>
                      <div class="item">
                        <div class="results-website">
                          <a href="www.lorem-ipsum.com" target="_blank">
                            <div class="icon">
                              <img src="/images/icons/icon-globe.svg" alt="Icon" />
                            </div>
                            www.lorem-ipsum.com
                          </a>
                        </div>
                        <div class="results-email">
                          <a href="mailto:lorem-ipsum@lorem-ipsum.com">
                            <div class="icon">
                              <img src="/images/icons/icon-mail.svg" alt="Icon" />
                            </div>
                            lorem-ipsum@lorem-ipsum.com
                          </a>
                        </div>
                      </div>
                      <div class="locations-wrapper">
                        <div class="item">

                          <div class="results-phone">
                            <a href="tel:049863545">
                              <div class="icon">
                                <img src="/images/icons/icon-phone-simple.svg" alt="Icon" />
                              </div>
                              049863545
                            </a>
                          </div>
                          <div class="results-waze">
                            <a href="#/">
                              <div class="icon">
                                <img src="/images/icons/icon-waze-simple.svg" alt="Icon" />
                              </div>
                              ת.ד 320, כפר מנדא
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="results-map">
                      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d43175.80723702404!2d-0.23689632527217233!3d51.51110006081656!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48760fefa6be6ee7%3A0x6a59f820ac676c4d!2sHolland%20Park!5e0!3m2!1sen!2scz!4v1738855438273!5m2!1sen!2scz" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </li>

        </ul>
      </div>
    </div>
    <div class="pagination">
      <button @click="prevPage" :disabled="pageIndex === 1">Previous</button>
      <span>Page {{ pageIndex }}</span>
      <button @click="nextPage">Next</button>
    </div>
  </div>
</template>

<script>
export default {
  props: {
    results: {
      type: Array,
      required: true
    },
    pageIndex: {
      type: Number,
      required: true
    }
  },
  methods: {
    prevPage() {
      this.$emit('update:pageIndex', this.pageIndex - 1);
    },
    nextPage() {
      this.$emit('update:pageIndex', this.pageIndex + 1);
    },
    imageUrl(logoName) {
      if (!logoName) {
        return '/images/logos/logo-default.png';
      }
      return `http://www.countdown.tempurl.co.il/app/logo/${logoName}`;
    },
    userLocation() {
      const userCoordinates = localStorage.getItem("userCoordinates");
      return !!userCoordinates;
    },
    calculateDistance(location) {
      const userCoordinates = this.userLocation();
      if (!userCoordinates || !location) return null;

      const { latitude: userLat, longitude: userLng } = userCoordinates;
      const [locLng, locLat] = location;

      const toRad = (value) => (value * Math.PI) / 180;

      const R = 6371; // Radius of the Earth in km
      const dLat = toRad(locLat - userLat);
      const dLng = toRad(locLng - userLng);
      const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(toRad(userLat)) * Math.cos(toRad(locLat)) *
          Math.sin(dLng / 2) * Math.sin(dLng / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const distance = R * c * 1000; // Convert to meters

      return Math.round(distance);
    }
  }
};
</script>

<style scoped>
/* Add any styles if needed */
</style>
